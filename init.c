
#define CONFIGURE_INIT

#include "sys_cfg.h"
#include <intrinsic.h>
#include <sysreg.h>
#include <complex_i.h>
#include "math.h"
#include <stdio.h>
#include <time.h>
//#include "sin_cos_256.h"
#include "cos_sin_512.h"

#define M 512
#define pi 3.1415926
typedef struct complex{
    double real;
    double image;
}Complex;

//子函数
void bw_cfft(__complex_f32 *in, __complex_f32 *twiddle, __complex_f32 *out,int n);
//void complex_multi(__complex_f32 *input1,__complex_f32 *input2, __complex_f32*output,int n);
//void bw_cvifft_f(__complex_f32 *pcSrc, __complex_f32 *pfTwid,__complex_f32 *pcDes, int n);
//void div_func(__complex_f32 *input, unsigned int n, float divisor);
//void bw_cvabs_f(__complex_f32 *pcSrc, float *pfDes, int nLen);
int get_coreid();
void init(Complex *fx,double *real,double *image);
void DFT(Complex *fu,Complex *fx,clock_t FFTstartTime,clock_t FFTendTime);
void Fir(Complex *Firout,Complex *fx,double *fir,clock_t FirstartTime,clock_t FirendTime);


//输入数据
//#pragma DATA_SECTION(lfmback, ".ccdata3")//时域回波
//__complex_f32 lfmback[8*4096] = {
//#include "lfmback.dat"
//};
//#pragma DATA_SECTION(Hf, ".ccdata5")//频域滤波器
//__complex_f32 Hf[4096] = {
//#include "Hf.dat"
//};
//#pragma DATA_SECTION(twid_4096,".ccdata1")//旋转因子
//__complex_f32 twid_4096[4096]= {
//#include "twid_4096.dat"
//};
//#pragma DATA_SECTION(win,".ccdata1")//窗函数
//__complex_f32 win[4096]= {
//#include "win.dat"
//};


//变量声明
//#pragma DATA_SECTION(F_lfmback, ".ccdata4")
//__complex_f32 F_lfmback[8*4096];
//float result1[4*4096];
//float result2[4*4096];
int Core_ID,a,b;

//#pragma DATA_SECTION(fx, ".ccdata1")
//Complex fx[2*256];
//#pragma DATA_SECTION(fu, ".ccdata1")
//Complex fu[2*256];

#pragma DATA_SECTION(fxReal, ".ccdata1")
double fxReal[512];
#pragma DATA_SECTION(fxImag, ".ccdata1")
double fxImag[512];


#pragma DATA_SECTION(fuReal, ".ccdata1")
double fuReal[512];

#pragma DATA_SECTION(outReal, ".ccdata1")
double outReal[512];
#pragma DATA_SECTION(outRealFFT, ".ccdata1")
double outRealFFT[512];

int main(const char *cmdline)
{
    Complex fx[M];
    Complex fu[M];
    Complex FirOut[M];
    Complex FirOutFFT[M];
    clock_t FFTstartTime,FFTendTime,FIRstartTime,FIRendTime,FIRFFTstartTime,FIRFFTendTime;
//    double real[256]={1,2.4157e-05,-0.99992,-0.037169,0.99724,0.12349,-0.98281,-0.25699,0.94057,0.43089,-0.84894,-0.6292,0.68471,0.82207,-0.43041,-0.9633,0.086109,0.99377,0.31645,-0.85531,-0.70304,0.51734,0.95995,-0.011861,-0.96307,-0.53921,0.63813,0.93216,-0.036493,-0.95238,-0.61984,0.50655,0.98911,0.24553,-0.79229,-0.88044,0.061055,0.9271,0.74587,-0.25605,-0.97514,-0.65803,0.33864,0.9849,0.64871,-0.31521,-0.9723,-0.72075,0.18354,0.91747,0.84958,0.062791,-0.76892,-0.97275,-0.40918,0.46295,0.98027,0.77808,0.025821,-0.7363,-0.99522,-0.60063,0.17117,0.82824,0.98071,0.56039,-0.17113,-0.79949,-0.99523,-0.67674,-0.025966,0.62803,0.98024,0.88648,0.40941,-0.2316,-0.76874,-0.99801,-0.84976,-0.39813,0.18316,0.6929,0.9722,0.94917,0.64908,0.17365,-0.33814,-0.75262,-0.97501,-0.96682,-0.74629,-0.37541,0.060379,0.47354,0.79185,0.9692,0.98922,0.86261,0.62048,0.30571,-0.035624,-0.36122,-0.63742,-0.84166,-0.9628,-0.99994,-0.96023,-0.85631,-0.70379,-0.51904,-0.31751,-0.1126,0.084954,0.26729,0.42932,0.56837,0.68379,0.77644,0.84825,0.90183,0.94011,0.96606,0.98255,0.99217,0.99713,0.99925,0.9999,1,1,0.9999,0.99925,0.99713,0.99217,0.98255,0.96606,0.94011,0.90183,0.84825,0.77644,0.68379,0.56837,0.42932,0.26729,0.084954,-0.1126,-0.31751,-0.51904,-0.70379,-0.85631,-0.96023,-0.99994,-0.9628,-0.84166,-0.63742,-0.36122,-0.035624,0.30571,0.62048,0.86261,0.98922,0.9692,0.79185,0.47354,0.060379,-0.37541,-0.74629,-0.96682,-0.97501,-0.75262,-0.33814,0.17365,0.64908,0.94917,0.9722,0.6929,0.18316,-0.39813,-0.84976,-0.99801,-0.76874,-0.2316,0.40941,0.88648,0.98024,0.62803,-0.025966,-0.67674,-0.99523,-0.79949,-0.17113,0.56039,0.98071,0.82824,0.17117,-0.60063,-0.99522,-0.7363,0.025821,0.77808,0.98027,0.46295,-0.40918,-0.97275,-0.76892,0.062791,0.84958,0.91747,0.18354,-0.72075,-0.9723,-0.31521,0.64871,0.9849,0.33864,-0.65803,-0.97514,-0.25605,0.74587,0.9271,0.061055,-0.88044,-0.79229,0.24553,0.98911,0.50655,-0.61984,-0.95238,-0.036493,0.93216,0.63813,-0.53921,-0.96307,-0.011861,0.95995,0.51734,-0.70304,-0.85531,0.31645,0.99377,0.086109,-0.9633,-0.43041,0.82207,0.68471,-0.6292,-0.84894,0.43089,0.94057,-0.25699,-0.98281,0.12349,0.99724,-0.037169,-0.99992,2.4157e-05,1};
//    double imag[256]={-1.813e-14,-1,-0.012416,0.99931,0.074238,-0.99235,-0.1846,0.96641,0.33961,-0.90241,-0.52848,0.77724,0.72882,-0.56938,-0.90263,0.26843,0.99629,0.11147,-0.94861,-0.51811,0.71115,0.85578,-0.28019,-0.99993,-0.26927,0.84217,0.76993,-0.36205,-0.99933,-0.3049,0.78473,0.86221,-0.14721,-0.96939,-0.61015,0.47416,0.99813,0.37481,-0.66609,-0.96666,-0.2216,0.75299,0.94092,0.17315,-0.76104,-0.94902,-0.23373,0.6932,0.98301,0.3978,-0.52746,-0.99803,-0.63934,0.23185,0.91245,0.88638,0.19765,-0.62817,-0.99967,-0.67665,0.097679,0.79953,0.98524,0.56037,-0.19547,-0.82823,-0.98525,-0.60069,0.097583,0.73622,0.99966,0.77819,0.19783,-0.46276,-0.91235,-0.97281,-0.63956,-0.063104,0.52717,0.91733,0.98308,0.72103,0.23416,-0.31478,-0.76072,-0.98481,-0.9411,-0.65845,-0.22216,0.25547,0.66562,0.92686,0.99818,0.88077,0.61072,0.24626,-0.14644,-0.50587,-0.78422,-0.95213,-0.99937,-0.93248,-0.77051,-0.54,-0.2702,0.01087,0.27921,0.51646,0.7104,0.85475,0.94826,0.99364,0.99638,0.96362,0.90315,0.82277,0.72968,0.63019,0.52959,0.43209,0.34088,0.25832,0.18598,0.1249,0.075683,0.038641,0.013914,0.001546,0.001546,0.013914,0.038641,0.075683,0.1249,0.18598,0.25832,0.34088,0.43209,0.52959,0.63019,0.72968,0.82277,0.90315,0.96362,0.99638,0.99364,0.94826,0.85475,0.7104,0.51646,0.27921,0.01087,-0.2702,-0.54,-0.77051,-0.93248,-0.99937,-0.95213,-0.78422,-0.50587,-0.14644,0.24626,0.61072,0.88077,0.99818,0.92686,0.66562,0.25547,-0.22216,-0.65845,-0.9411,-0.98481,-0.76072,-0.31478,0.23416,0.72103,0.98308,0.91733,0.52717,-0.063104,-0.63956,-0.97281,-0.91235,-0.46276,0.19783,0.77819,0.99966,0.73622,0.097583,-0.60069,-0.98525,-0.82823,-0.19547,0.56037,0.98524,0.79953,0.097679,-0.67665,-0.99967,-0.62817,0.19765,0.88638,0.91245,0.23185,-0.63934,-0.99803,-0.52746,0.3978,0.98301,0.6932,-0.23373,-0.94902,-0.76104,0.17315,0.94092,0.75299,-0.2216,-0.96666,-0.66609,0.37481,0.99813,0.47416,-0.61015,-0.96939,-0.14721,0.86221,0.78473,-0.3049,-0.99933,-0.36205,0.76993,0.84217,-0.26927,-0.99993,-0.28019,0.85578,0.71115,-0.51811,-0.94861,0.11147,0.99629,0.26843,-0.90263,-0.56938,0.72882,0.77724,-0.52848,-0.90241,0.33961,0.96641,-0.1846,-0.99235,0.074238,0.99931,-0.012416,-1,-1.813e-14};
    double real[512]={1,6.0156e-06,-0.99998,-0.018497,0.99932,0.061591,-0.99573,-0.12904,0.98515,0.22,-0.96181,-0.33242,0.91846,0.46227,-0.84691,-0.6027,0.73895,0.74321,-0.5877,-0.86914,0.38968,0.96186,-0.14718,-0.99993,-0.12914,0.96179,0.4181,-0.8301,-0.68735,0.59758,0.89524,-0.27349,-0.9963,-0.11084,0.951,0.50017,-0.73887,-0.81986,0.37251,0.98912,0.09249,-0.94308,-0.55768,0.65975,0.898,-0.18351,-0.99571,-0.36722,0.78658,0.81989,-0.30289,-1,-0.30928,0.80521,0.81991,-0.27338,-0.99808,-0.39573,0.72622,0.89803,-0.091951,-0.96174,-0.6078,0.51034,0.98914,0.24425,-0.79781,-0.86926,0.10418,0.95095,0.67396,-0.38945,-0.9993,-0.46254,0.5974,0.98304,0.27404,-0.73458,-0.93913,-0.1294,0.81596,0.89535,0.037366,-0.85642,-0.8693,-0.00042711,0.86581,0.8693,0.018918,-0.84672,-0.89536,-0.092717,0.79401,0.93915,0.2204,-0.6958,-0.98306,-0.39589,0.53646,0.9993,0.60302,-0.30269,-0.9509,-0.80931,-0.0066592,0.79771,0.96196,0.36745,-0.51019,-0.99158,-0.71827,0.091747,0.82989,0.95853,0.39594,-0.44526,-0.96966,-0.82005,-0.1112,0.66872,1,0.67411,-0.085575,-0.7864,-0.98917,-0.57824,0.18319,0.82986,0.98075,0.55797,-0.18318,-0.81586,-0.98918,-0.61774,0.085539,0.73861,1,0.74355,0.11126,-0.57224,-0.96965,-0.89544,-0.39602,0.2849,0.82984,0.99579,0.71835,0.12963,-0.51009,-0.93,-0.962,-0.60315,-0.0068036,0.58726,0.95086,0.95314,0.60316,0.037607,-0.53631,-0.91823,-0.98309,-0.71837,-0.2206,0.34332,0.79388,0.99567,0.89546,0.53223,0.019158,-0.49406,-0.86568,-1,-0.86943,-0.51651,-0.037643,0.44512,0.81579,0.99155,0.93923,0.67875,0.27434,-0.18306,-0.59714,-0.88645,-0.99929,-0.92118,-0.67422,-0.3097,0.10382,0.49403,0.79758,0.96962,0.9892,0.86017,0.60811,0.27436,-0.091543,-0.43956,-0.72593,-0.9182,-0.99806,-0.96203,-0.82016,-0.59335,-0.30972,-0.00073992,0.30245,0.57213,0.78629,0.92996,0.99567,0.98311,0.89822,0.75183,0.55811,0.33306,0.093017,-0.14656,-0.372,-0.57212,-0.7385,-0.86565,-0.95082,-0.99378,-0.99635,-0.96203,-0.8955,-0.80217,-0.68779,-0.55812,-0.41865,-0.2744,-0.12976,0.011556,0.14655,0.27293,0.38908,0.49399,0.58717,0.66856,0.73849,0.79755,0.84655,0.88642,0.91818,0.9429,0.96161,0.97534,0.98503,0.99155,0.99566,0.99806,0.99929,0.99981,0.99998,1,1,0.99998,0.99981,0.99929,0.99806,0.99566,0.99155,0.98503,0.97534,0.96161,0.9429,0.91818,0.88642,0.84655,0.79755,0.73849,0.66856,0.58717,0.49399,0.38908,0.27293,0.14655,0.011556,-0.12976,-0.2744,-0.41865,-0.55812,-0.68779,-0.80217,-0.8955,-0.96203,-0.99635,-0.99378,-0.95082,-0.86565,-0.7385,-0.57212,-0.372,-0.14656,0.093017,0.33306,0.55811,0.75183,0.89822,0.98311,0.99567,0.92996,0.78629,0.57213,0.30245,-0.00073992,-0.30972,-0.59335,-0.82016,-0.96203,-0.99806,-0.9182,-0.72593,-0.43956,-0.091543,0.27436,0.60811,0.86017,0.9892,0.96962,0.79758,0.49403,0.10382,-0.3097,-0.67422,-0.92118,-0.99929,-0.88645,-0.59714,-0.18306,0.27434,0.67875,0.93923,0.99155,0.81579,0.44512,-0.037643,-0.51651,-0.86943,-1,-0.86568,-0.49406,0.019158,0.53223,0.89546,0.99567,0.79388,0.34332,-0.2206,-0.71837,-0.98309,-0.91823,-0.53631,0.037607,0.60316,0.95314,0.95086,0.58726,-0.0068036,-0.60315,-0.962,-0.93,-0.51009,0.12963,0.71835,0.99579,0.82984,0.2849,-0.39602,-0.89544,-0.96965,-0.57224,0.11126,0.74355,1,0.73861,0.085539,-0.61774,-0.98918,-0.81586,-0.18318,0.55797,0.98075,0.82986,0.18319,-0.57824,-0.98917,-0.7864,-0.085575,0.67411,1,0.66872,-0.1112,-0.82005,-0.96966,-0.44526,0.39594,0.95853,0.82989,0.091747,-0.71827,-0.99158,-0.51019,0.36745,0.96196,0.79771,-0.0066592,-0.80931,-0.9509,-0.30269,0.60302,0.9993,0.53646,-0.39589,-0.98306,-0.6958,0.2204,0.93915,0.79401,-0.092717,-0.89536,-0.84672,0.018918,0.8693,0.86581,-0.00042711,-0.8693,-0.85642,0.037366,0.89535,0.81596,-0.1294,-0.93913,-0.73458,0.27404,0.98304,0.5974,-0.46254,-0.9993,-0.38945,0.67396,0.95095,0.10418,-0.86926,-0.79781,0.24425,0.98914,0.51034,-0.6078,-0.96174,-0.091951,0.89803,0.72622,-0.39573,-0.99808,-0.27338,0.81991,0.80521,-0.30928,-1,-0.30289,0.81989,0.78658,-0.36722,-0.99571,-0.18351,0.898,0.65975,-0.55768,-0.94308,0.09249,0.98912,0.37251,-0.81986,-0.73887,0.50017,0.951,-0.11084,-0.9963,-0.27349,0.89524,0.59758,-0.68735,-0.8301,0.4181,0.96179,-0.12914,-0.99993,-0.14718,0.96186,0.38968,-0.86914,-0.5877,0.74321,0.73895,-0.6027,-0.84691,0.46227,0.91846,-0.33242,-0.96181,0.22,0.98515,-0.12904,-0.99573,0.061591,0.99932,-0.018497,-0.99998,6.0156e-06,1};
    double imag[512]={-3.6259e-14,-1,-0.006172,0.99983,0.036975,-0.9981,-0.092304,0.99164,0.17167,-0.9755,-0.27372,0.94313,0.39552,-0.88674,-0.53173,0.79796,0.67376,-0.66906,-0.80908,0.49456,0.92095,-0.27355,-0.98911,0.012187,0.99163,0.2738,-0.9084,-0.55762,0.72632,0.80181,-0.44559,-0.96187,0.085953,0.99384,0.3092,-0.86593,-0.67384,0.57257,0.92803,-0.14709,-0.99571,-0.33257,0.83005,0.75149,-0.44,-0.98302,-0.09252,0.93013,0.61748,-0.57252,-0.95302,-0.00027672,0.95097,0.59299,-0.5725,-0.96191,-0.061861,0.91837,0.68746,-0.43993,-0.99576,-0.27397,0.79409,0.85997,-0.14697,-0.96971,-0.60291,0.49435,0.99456,0.30936,-0.73876,-0.92105,-0.037324,0.8866,0.80194,-0.18337,-0.96172,-0.67852,0.34357,0.99159,0.57811,-0.44537,-0.9993,-0.51628,0.49429,1,0.50037,-0.49428,-0.99982,-0.53203,0.44534,0.99569,0.6079,-0.34352,-0.97541,-0.71824,0.18329,0.9183,0.84392,0.037432,-0.79772,-0.95309,-0.30948,0.58738,0.99998,0.60304,-0.27318,-0.93004,-0.86006,-0.12951,0.69576,0.99578,0.55793,-0.28498,-0.91828,-0.8954,-0.24444,0.57229,0.9938,0.74351,0.00055343,-0.73863,-0.99633,-0.61772,0.14674,0.81587,0.98308,0.55797,-0.19528,-0.82986,-0.98308,-0.57825,0.14672,0.78638,0.99633,0.67414,0.00060156,-0.66868,-0.99379,-0.82009,-0.24451,0.44519,0.91824,0.95856,0.55801,-0.091645,-0.69568,-0.99156,-0.86012,-0.36757,0.27305,0.79763,0.99998,0.8094,0.30963,-0.30253,-0.79762,-0.99929,-0.84402,-0.39606,0.1831,0.69566,0.97537,0.93922,0.60807,0.092939,-0.44513,-0.8466,-0.99982,-0.86943,-0.50059,-0.00068578,0.49406,0.85628,0.99929,0.89547,0.57834,0.12969,-0.34329,-0.73437,-0.96163,-0.9831,-0.80214,-0.46283,-0.037661,0.38913,0.73853,0.95084,0.9946,0.86944,0.60321,0.24461,-0.14659,-0.51001,-0.79385,-0.96163,-0.9958,-0.89821,-0.68777,-0.39612,-0.062293,0.27296,0.57213,0.80494,0.95083,1,0.95317,0.82017,0.61786,0.36767,0.093011,-0.18302,-0.43954,-0.65936,-0.82977,-0.9429,-0.99566,-0.9892,-0.92823,-0.82017,-0.67425,-0.50065,-0.30974,-0.11141,0.085377,0.27293,0.44506,0.5971,0.72591,0.82976,0.90815,0.96162,0.99155,0.99993,0.9892,0.96203,0.9212,0.86947,0.80947,0.74366,0.67426,0.60325,0.53231,0.46288,0.39616,0.33308,0.2744,0.2207,0.17238,0.12976,0.093035,0.062329,0.037721,0.019249,0.0069299,0.00077,0.00077,0.0069299,0.019249,0.037721,0.062329,0.093035,0.12976,0.17238,0.2207,0.2744,0.33308,0.39616,0.46288,0.53231,0.60325,0.67426,0.74366,0.80947,0.86947,0.9212,0.96203,0.9892,0.99993,0.99155,0.96162,0.90815,0.82976,0.72591,0.5971,0.44506,0.27293,0.085377,-0.11141,-0.30974,-0.50065,-0.67425,-0.82017,-0.92823,-0.9892,-0.99566,-0.9429,-0.82977,-0.65936,-0.43954,-0.18302,0.093011,0.36767,0.61786,0.82017,0.95317,1,0.95083,0.80494,0.57213,0.27296,-0.062293,-0.39612,-0.68777,-0.89821,-0.9958,-0.96163,-0.79385,-0.51001,-0.14659,0.24461,0.60321,0.86944,0.9946,0.95084,0.73853,0.38913,-0.037661,-0.46283,-0.80214,-0.9831,-0.96163,-0.73437,-0.34329,0.12969,0.57834,0.89547,0.99929,0.85628,0.49406,-0.00068578,-0.50059,-0.86943,-0.99982,-0.8466,-0.44513,0.092939,0.60807,0.93922,0.97537,0.69566,0.1831,-0.39606,-0.84402,-0.99929,-0.79762,-0.30253,0.30963,0.8094,0.99998,0.79763,0.27305,-0.36757,-0.86012,-0.99156,-0.69568,-0.091645,0.55801,0.95856,0.91824,0.44519,-0.24451,-0.82009,-0.99379,-0.66868,0.00060156,0.67414,0.99633,0.78638,0.14672,-0.57825,-0.98308,-0.82986,-0.19528,0.55797,0.98308,0.81587,0.14674,-0.61772,-0.99633,-0.73863,0.00055343,0.74351,0.9938,0.57229,-0.24444,-0.8954,-0.91828,-0.28498,0.55793,0.99578,0.69576,-0.12951,-0.86006,-0.93004,-0.27318,0.60304,0.99998,0.58738,-0.30948,-0.95309,-0.79772,0.037432,0.84392,0.9183,0.18329,-0.71824,-0.97541,-0.34352,0.6079,0.99569,0.44534,-0.53203,-0.99982,-0.49428,0.50037,1,0.49429,-0.51628,-0.9993,-0.44537,0.57811,0.99159,0.34357,-0.67852,-0.96172,-0.18337,0.80194,0.8866,-0.037324,-0.92105,-0.73876,0.30936,0.99456,0.49435,-0.60291,-0.96971,-0.14697,0.85997,0.79409,-0.27397,-0.99576,-0.43993,0.68746,0.91837,-0.061861,-0.96191,-0.5725,0.59299,0.95097,-0.00027672,-0.95302,-0.57252,0.61748,0.93013,-0.09252,-0.98302,-0.44,0.75149,0.83005,-0.33257,-0.99571,-0.14709,0.92803,0.57257,-0.67384,-0.86593,0.3092,0.99384,0.085953,-0.96187,-0.44559,0.80181,0.72632,-0.55762,-0.9084,0.2738,0.99163,0.012187,-0.98911,-0.27355,0.92095,0.49456,-0.80908,-0.66906,0.67376,0.79796,-0.53173,-0.88674,0.39552,0.94313,-0.27372,-0.9755,0.17167,0.99164,-0.092304,-0.9981,0.036975,0.99983,-0.006172,-1,-3.6259e-14};
    double fir[257]={-3.90198259631797e-19,-7.69399430200007e-05,-0.000144037816778232,-0.000191330357068709,-0.000211253536583041,-0.000199737698911618,-0.000156931551900588,-8.74399293562601e-05,1.27133225414911e-18,9.34227334454144e-05,0.000179066251064448,0.000243200393801425,0.000274144430756270,0.000264206421816362,0.000211247027806411,0.000119582277521397,-5.60985184766412e-19,-0.000131227978105404,-0.000254311338932757,-0.000348695345640400,-0.000396259034278286,-0.000384493397983266,-0.000309137670252132,-0.000175774986892726,-9.46221782306935e-19,0.000194037189181706,0.000376657120507204,0.000516922818628100,0.000587585635342211,0.000569954692911050,0.000457868676088150,0.000260010117320960,-1.04734519900584e-18,-0.000285974849735089,-0.000553859230352953,-0.000758203546188164,-0.000859511784410416,-0.000831324376857556,-0.000665829767576372,-0.000376928770187265,5.04614277941854e-18,0.000411904074713257,0.000795129651603609,0.00108488901324354,0.00122577125121943,0.00118165058507489,0.000943301708331748,0.000532264937556302,-1.77523439904664e-18,-0.000577934857597311,-0.00111214188669669,-0.00151276744842664,-0.00170407366493086,-0.00163790824453301,-0.00130377891228373,-0.000733612778502377,2.19612580381486e-18,0.000792306835152765,0.00152078181615863,0.00206352064545268,0.00231896209072054,0.00222383775427193,0.00176630703760496,0.000991788698159517,-2.63383825251463e-18,-0.00106697166667551,-0.00204430283264165,-0.00276917611749228,-0.00310702201977249,-0.00297515166384769,-0.00235979849956216,-0.00132336307166806,3.07155070121441e-18,0.00142057722818641,0.00271932223327247,0.00368063687477874,0.00412694509270386,0.00394968194459602,0.00313151945886736,0.00175568625777017,-3.49244210598262e-18,-0.00188451107316735,-0.00360809347875012,-0.00488533053648962,-0.00548058996029350,-0.00524886759482670,-0.00416528309685235,-0.00233780063124080,3.88033784617265e-18,0.00251637999575026,0.00482627265852199,0.00654773930835705,0.00736210164415522,0.00706868408307855,0.00562530213095681,0.00316720817139675,-4.22033130602342e-18,-0.00343433867744495,-0.00661506366163568,-0.00901694338293292,-0.0101911492793259,-0.00984102474154853,-0.00788092360822978,-0.00446798599580843,4.49935672754341e-18,0.00492300464161697,0.00957065668449924,0.0131798132913828,0.0150657383826646,0.0147320568436024,0.0119638218235059,0.00688936322418980,-4.70669132026285e-18,-0.00787817886806724,-0.0156600627811270,-0.0221179333995667,-0.0260258324489682,-0.0263147660571347,-0.0222193222480104,-0.0133964639001025,4.83436733205812e-18,0.0173007498469741,0.0373628984623062,0.0586698271474239,0.0794788262047623,0.0980001926898867,0.112587137595826,0.121914107617386,0.125122197146583,0.121914107617386,0.112587137595826,0.0980001926898867,0.0794788262047623,0.0586698271474239,0.0373628984623062,0.0173007498469741,4.83436733205812e-18,-0.0133964639001025,-0.0222193222480104,-0.0263147660571347,-0.0260258324489682,-0.0221179333995667,-0.0156600627811270,-0.00787817886806724,-4.70669132026285e-18,0.00688936322418980,0.0119638218235059,0.0147320568436024,0.0150657383826646,0.0131798132913828,0.00957065668449924,0.00492300464161697,4.49935672754341e-18,-0.00446798599580843,-0.00788092360822978,-0.00984102474154853,-0.0101911492793259,-0.00901694338293292,-0.00661506366163568,-0.00343433867744495,-4.22033130602342e-18,0.00316720817139675,0.00562530213095681,0.00706868408307855,0.00736210164415522,0.00654773930835705,0.00482627265852199,0.00251637999575026,3.88033784617265e-18,-0.00233780063124080,-0.00416528309685235,-0.00524886759482670,-0.00548058996029350,-0.00488533053648962,-0.00360809347875012,-0.00188451107316735,-3.49244210598262e-18,0.00175568625777017,0.00313151945886736,0.00394968194459602,0.00412694509270386,0.00368063687477874,0.00271932223327247,0.00142057722818641,3.07155070121441e-18,-0.00132336307166806,-0.00235979849956216,-0.00297515166384769,-0.00310702201977249,-0.00276917611749228,-0.00204430283264165,-0.00106697166667551,-2.63383825251463e-18,0.000991788698159517,0.00176630703760496,0.00222383775427193,0.00231896209072054,0.00206352064545268,0.00152078181615863,0.000792306835152765,2.19612580381486e-18,-0.000733612778502377,-0.00130377891228373,-0.00163790824453301,-0.00170407366493086,-0.00151276744842664,-0.00111214188669669,-0.000577934857597311,-1.77523439904664e-18,0.000532264937556302,0.000943301708331748,0.00118165058507489,0.00122577125121943,0.00108488901324354,0.000795129651603609,0.000411904074713257,5.04614277941854e-18,-0.000376928770187265,-0.000665829767576372,-0.000831324376857556,-0.000859511784410416,-0.000758203546188164,-0.000553859230352953,-0.000285974849735089,-1.04734519900584e-18,0.000260010117320960,0.000457868676088150,0.000569954692911050,0.000587585635342211,0.000516922818628100,0.000376657120507204,0.000194037189181706,-9.46221782306935e-19,-0.000175774986892726,-0.000309137670252132,-0.000384493397983266,-0.000396259034278286,-0.000348695345640400,-0.000254311338932757,-0.000131227978105404,-5.60985184766412e-19,0.000119582277521397,0.000211247027806411,0.000264206421816362,0.000274144430756270,0.000243200393801425,0.000179066251064448,9.34227334454144e-05,1.27133225414911e-18,-8.74399293562601e-05,-0.000156931551900588,-0.000199737698911618,-0.000211253536583041,-0.000191330357068709,-0.000144037816778232,-7.69399430200007e-05,-3.90198259631797e-19};

    init(&fx[0],&real[0],&imag[0]);

    DFT(&fu[0],&fx[0],FFTstartTime,FFTendTime);

    Fir(&FirOut[0],&fx[0],&fir[0],FFTstartTime,FFTendTime);

    DFT(&FirOutFFT[0],&FirOut[0],FIRFFTstartTime,FIRFFTendTime);

	int finNUM;
    for(finNUM=0;finNUM<512;finNUM++){
    	fxReal[finNUM]=fx[finNUM].real;
    	fxImag[finNUM]=fx[finNUM].image;
    	fuReal[finNUM]=fabs(fu[finNUM].real);
    	outReal[finNUM]=FirOut[finNUM].real;
    	outRealFFT[finNUM]=fabs(FirOutFFT[finNUM].real);
    }
//	int a=1;
//	int b=2;
//	Core_ID=get_coreid();
//		if(!Core_ID)
//			{
//			for(i=0;i<4;i=i+1)//0 1 2 3
//			{
//				bw_cfft((__complex_f32*)(lfmback+i*4096),(__complex_f32*)twid_4096,(__complex_f32*)(F_lfmback+i*4096), 4096);
//				complex_multi((__complex_f32*)Hf,(__complex_f32*)(F_lfmback+i*4096), (__complex_f32*)(lfmback+i*4096),4096);//频域相乘
//				complex_multi((__complex_f32*)win,(__complex_f32*)(lfmback+i*4096), (__complex_f32*)(F_lfmback+i*4096),4096);//频域加窗
//				bw_cvifft_f((__complex_f32 *)(F_lfmback+i*4096), (__complex_f32 *)twid_4096,(__complex_f32 *)(lfmback+i*4096),4096);//IFFT
//				div_func((__complex_f32*)(lfmback+i*4096),4096, ((float)1) /4096); //除以点数分之一
//				bw_cvabs_f((__complex_f32 *)(lfmback+i*4096),(result1+i*4096), 4096);//取模值
//			}
//			a=1;
//			}
//		else
//		{
//			for(i=4;i<8;i=i+1)//4 5 6 7
//			{
//				bw_cfft((__complex_f32*)(lfmback+i*4096),(__complex_f32*)twid_4096,(__complex_f32*)(F_lfmback+i*4096), 4096);
//				complex_multi((__complex_f32*)Hf,(__complex_f32*)(F_lfmback+i*4096), (__complex_f32*)(lfmback+i*4096),4096);//频域相乘
//				complex_multi((__complex_f32*)win,(__complex_f32*)(lfmback+i*4096), (__complex_f32*)(F_lfmback+i*4096),4096);//频域加窗
//				bw_cvifft_f((__complex_f32 *)(F_lfmback+i*4096), (__complex_f32 *)twid_4096,(__complex_f32 *)(lfmback+i*4096),4096);//IFFT
//				div_func((__complex_f32*)(lfmback+i*4096),4096, ((float)1) /4096); //除以点数分之一
//				bw_cvabs_f((__complex_f32 *)(lfmback+i*4096),(result2+(i-4)*4096), 4096);//取模值
//			}
//			b=1;
//		}

	return 0;
}
void init(Complex *fx,double *real,double *imag){
    printf("-----------------------------\n");
    printf("----------DATA READING--------\n");
    printf("-----------------------------\n");
    //    srand((int)time(0));
    int i=0;
    int a=1;
    int b=2;
    for(i=0;i<512;i++){
        fx[i].real=real[i];
        fx[i].image=imag[i];
        }
//    for(i=0;i<256;i++){
//        printf("fx[%2d]:%8.6lf+%8.6lfj\n",i,fx[i].real,fx[i].image);}
}

void DFT(Complex *fu,Complex fx[],clock_t FFTstartTime,clock_t FFTendTime){
    int u, x,num,N;
    double real,image;
    printf("-----------------------------\n");
    printf("---------DFT--------\n");
    printf("-----------------------------\n");
    FFTstartTime=clock();
    double sin_value;
    for(u=0;u<512;u++){
        real=0;
        image=0;
        int i=0;
//        int a=1;
//        int b=2;
//        Core_ID=get_coreid();
//        if(!Core_ID){
//			for(x=0;x<128;x++){
//	//            real+=(fx[x].real*(2*cos(3.1415926)*u*x/1024)-fx[x].image*(-sin(2*(3.1415926)*u*x/1024)));
//	//            image+=(fx[x].image*cos(2*(3.1415926)*u*x/1024)+fx[x].real*(-sin(2*(3.1415926)*u*x/1024)));
//				real+=(fx[x].real*(2*cos(3.1415926)*u*x*0.00390625)-fx[x].image*(-sin(2*(3.1415926)*u*x*0.00390625)));
//				image+=(fx[x].image*cos(2*(3.1415926)*u*x*0.00390625)+fx[x].real*(-sin(2*(3.1415926)*u*x*0.00390625)));
//			}
//			a=1;}
//		else{
//			for(x=128;x<256;x++){
//	//            real+=(fx[x].real*(2*cos(3.1415926)*u*x/1024)-fx[x].image*(-sin(2*(3.1415926)*u*x/1024)));
//	//            image+=(fx[x].image*cos(2*(3.1415926)*u*x/1024)+fx[x].real*(-sin(2*(3.1415926)*u*x/1024)));
//				real+=(fx[x].real*(2*cos(3.1415926)*u*x*0.00390625)-fx[x].image*(-sin(2*(3.1415926)*u*x*0.00390625)));
//				image+=(fx[x].image*cos(2*(3.1415926)*u*x*0.00390625)+fx[x].real*(-sin(2*(3.1415926)*u*x*0.00390625)));
//			}
//			b=1;
//			}
        for(x=0;x<512;x++){
//          	real+=(fx[x].real*cos(2*(3.1415926)*u*x*0.001953125)-fx[x].image*(-sin(2*(3.1415926)*u*x*0.001953125)));
//        	image+=(fx[x].image*cos(2*(3.1415926)*u*x*0.001953125)+fx[x].real*(-sin(2*(3.1415926)*u*x*0.001953125)));
//        	sin_value=sqrt(1-(cos_mx[u][x])*(cos_mx[u][x]));
        	N= (u*x)%1024;
          	real+=(fx[x].real*cos_mx[N]-fx[x].image*(-sin_mx[N]));
        	image+=(fx[x].image*cos_mx[N]+fx[x].real*(-sin_mx[N]));
        	}
        fu[u].real=real;
        fu[u].image=image;
        printf("DFT[%2d]:%8.6lf+%8.6lfj\n",u,fu[u].real,fu[u].image);
    }
    FFTendTime=clock();
    printf("DFT Time Used:    %lf\n",(double)(FFTendTime-FFTstartTime)/CLOCKS_PER_SEC);
}

void Fir(Complex *Firout,Complex *fx,double *fir,clock_t FirstartTime,clock_t FirendTime){
    printf("-----------------------------\n");
    printf("----------TIME FIR--------\n");
    printf("-----------------------------\n");
    int num4,num5,num1,num2,num3;
    double real,image;
    //补零
    double firZ[768];
    Complex fxZ[768];
    for(num4=0;num4<768;num4++){
        if (num4<257){firZ[num4]=fir[num4];}
        else{firZ[num4]=0;}
    }
    for(num5=0;num5<768;num5++){
        if (num5<512){
            fxZ[num5].real=fx[num5].real;
            fxZ[num5].image=fx[num5].image;}
        else{fxZ[num5].real=0;
            fxZ[num5].image=0;}
    }
    for (num1=0;num1<768;num1++){
        real=0;
        image=0;
        for (num2 = 0; num2 < 768; num2++) {
            if(num1-num2<0){
                real+=(firZ[num2]*fxZ[num1-num2+768].real);
                image+=(firZ[num2]*fxZ[num1-num2+768].image);
            }
            else{
                real+=(firZ[num2]*fxZ[num1-num2].real);
                image+=(firZ[num2]*fxZ[num1-num2].image);
            }
        }
        //截取1024长度
        if (num1<512){
            Firout[num1].real=real;
            Firout[num1].image=image;
            printf("Firout[%2d]:%8.6lf+%8.6lfj\n",num1,Firout[num1].real,Firout[num1].image);
        }

    }
//    for(num3=0;num3<256;num3++){
//        printf("Firout[%2d]:%8.6lf+%8.6lfj\n",num3,Firout[num3].real,Firout[num3].image);}
}

